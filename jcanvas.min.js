/**
 * jCanvas v13.07.03
 * Copyright 2013 Caleb Evans
 * Released under the MIT license
 */(function(e,t,n,r,i,s,o,u,a){function xn(e){var t=this;un(t,e);return t}function Tn(e){e?un(xn.prototype,e):Tn.prefs=xn.prototype=un({},on);return this}function Nn(e){return fn(e)==="string"}function Cn(e){return e&&e[A]?e[A]("2d"):u}function kn(e){e=un({},e);e.masks=e.masks[xt](0);return e}function Ln(e,t){e.save();t[O].push(kn(t[d]))}function An(e,t){if(t[O][f]===0)t[d]=kn(wn);else{e[st]();t[d]=t[O].pop()}}function On(e,t,n){ln(n[b])?t[b]=n[b][y](e,n):t[b]=n[b];ln(n[N])?t[N]=n[N][y](e,n):t[N]=n[N];t.lineWidth=n[ht];if(n.rounded)t.lineCap=t.lineJoin="round";else{t.lineCap=n.strokeCap;t.lineJoin=n.strokeJoin;t.miterLimit=n.miterLimit}t.shadowOffsetX=n.shadowX;t.shadowOffsetY=n.shadowY;t[St]=n[St];t[v]=n[v];t.globalAlpha=n.opacity;t.globalCompositeOperation=n.compositing;n[Ut]&&(t.webkitImageSmoothingEnabled=t.mozImageSmoothingEnabled=n[Ut])}function Mn(e,t,n){if(n.mask){n[vt]&&Ln(e,t);e.clip();t[d].masks.push(n._args)}}function _n(e,t){t._transformed&&e[st]()}function Dn(e,t,n){var r;n[bt]&&t[U]();if(n.shadowStroke&&n[ht]!==0){t.stroke();t.fill();t[v]=p;t[St]=0;t.stroke()}else{t.fill();n[b]!==p&&(t[v]=p);n[ht]!==0&&t.stroke()}n[bt]||t[U]();_n(t,n);if(n.mask){r=Fn(e);Mn(t,r,n)}}function Pn(e,t,n){t[J]=t[Tt]?hn/180:1;e[x](t.x,t.y);e[ut](t[ut]*t[J]);e[x](-t.x,-t.y);n[ut]+=t[ut]*t[J]}function Hn(e,t,n){t.scale!==1&&(t[at]=t[ot]=t.scale);e[x](t.x,t.y);e.scale(t[at],t[ot]);e[x](-t.x,-t.y);n[at]*=t[at];n[ot]*=t[ot]}function Bn(e,t,n){t[x]&&(t[j]=t[F]=t[x]);e[x](t[j],t[F]);n[j]+=t[j];n[F]+=t[F]}function jn(e,t,n,r){t[J]=t[Tt]?hn/180:1;t._transformed=s;e.save();r===a&&(r=n);if(!t.fromCenter&&!t._centered){t.x+=n/2;t.y+=r/2;t._centered=s}t[ut]&&Pn(e,t,{});(t.scale!==1||t[at]!==1||t[ot]!==1)&&Hn(e,t,{});(t[x]||t[j]||t[F])&&Bn(e,t,{})}function Fn(t){var n;if(bn._canvas===t&&bn._data)n=bn._data;else{n=e.data(t,rt);if(!n){n={canvas:t,layers:[],layer:{names:{},groups:{}},intersecting:[],drag:{},event:{type:u,x:u,y:u},events:{},transforms:kn(wn),savedTransforms:[],animating:o,animated:u,pixelRatio:1,scaled:!1};e.data(t,rt,n)}bn._canvas=t;bn._data=n}return n}function In(e,t,n){var r;for(r in Tn[D])Tn[D][Ht](r)&&qn(e,t,n,r)}function qn(e,t,n,r){if(n[r]){r=Yn(r);Tn[D][r](e,t);n[m]=s}}function Rn(e,t,n){var r,i,o;if(n[Ct]||n[k]||n[wt]){r=[W,_,Y];for(o=0;o<r[f];o+=1){i=Yn(r[o]);Tn[D][i](e,t)}if(!t[D].mouseoutdrag){e.bind("mouseout.jCanvas",function(){var n=t.drag[c];if(n){t.drag={};n.dragcancel&&n.dragcancel[y](e[0],n);e[B]()}});t[D].mouseoutdrag=s}n[m]=s}}function Un(e,t,n,r){var i=t[c].names;r?r[et]!==a&&Nn(n[et])&&n[I]!==r[I]&&delete i[n[et]]:r=n;Nn(r[et])&&(i[r[et]]=n)}function zn(e,t,n,r){var i=t[c][ft],s,o,u;if(!r)r=n;else if(r[I]!==a&&Nn(n[I])&&n[I]!==r[I]){s=i[n[I]];if(s){for(u=0;u<s[f];u+=1)if(s[u]===n){o=u;s[g](u,1);break}s[f]===0&&delete i[n[I]]}}if(Nn(r[I])){s=i[r[I]];if(!s){s=i[r[I]]=[];s[et]=r[I]}o===a&&(o=s[f]);s[g](o,0,n)}}function Wn(e,t,n,r){if(n&&n[C]&&n[P]){r?n._next=r:n._next=u;n[P][y](e,n)}}function Xn(t,n,r,i){var o,u,l=r,h;n._args=r;n.canvas=t;n[Ct]&&(n[c]=s);i?n[P]=i:n.method?n[P]=e.fn[n.method]:n.type?n[P]=e.fn[yn[n.type]]:n[P]=function(){};if(n[c]&&!n._layer){o=e(t);u=o[S]();h=Fn(t);l=new xn(n);Un(o,h,l);zn(o,h,l);In(o,h,l);Rn(o,h,l);n[m]=l[m];l[c]=s;l._layer=s;l[H]===a&&(l[H]=u[f]);u[g](l[H],0,l)}return l}function Vn(e){var t;for(t=0;t<En[f];t+=1)e[En[t]]=e["_"+En[t]]}function $n(e,t){var n;for(n=0;n<En[f];n+=1){e["_"+En[n]]=e[En[n]];Sn[En[n]]=1;t&&delete e[En[n]]}}function Jn(e,t,n){var r;for(r in n)n[Ht](r)&&ln(n[r])&&(n[r]=n[r][y](e,t,r));return n}function Kn(n){var r,s,o=[],u=1;if(n[Rt](/^#?\w+$/gi)){n===p&&(n="rgba(0,0,0,0)");s=t.head;r=s[pt][zt];s[pt][zt]=n;n=e.css(s,zt);s[pt][zt]=r}if(n[Rt](/^rgb/gi)){o=n[Rt](/\d+/gi);n[Rt](/%/gi)&&(u=2.55);o[0]*=u;o[1]*=u;o[2]*=u;o[3]!==a?o[3]=i(o[3]):o[3]=1}return o}function Qn(e){var t=3,n;if(fn(e[Bt])!=="array"){e[Bt]=Kn(e[Bt]);e.end=Kn(e.end)}e.now=[];if(e[Bt][3]!==1||e.end[3]!==1)t=4;for(n=0;n<t;n+=1){e.now[n]=e[Bt][n]+(e.end[n]-e[Bt][n])*e.pos;n<3&&(e.now[n]=cn(e.now[n]))}if(e[Bt][3]!==1||e.end[3]!==1)e.now="rgba("+e.now.join(",")+")";else{e.now[xt](0,3);e.now="rgb("+e.now.join(",")+")"}e.elem.nodeName?e.elem[pt][e.prop]=e.now:e.elem[e.prop]=e.now}function Gn(t){var n;for(n=0;n<t[f];n+=1)e.fx.step[t[n]]=Qn}function Yn(e){"ontouchstart"in window&&mn[e]&&(e=mn[e]);return e}function Zn(e){gn[e]&&(e=gn[e]);return e}function er(e){Tn[D][e]=function(t,n){var r,i;e=Yn(e);i=n[K];r=e===R||e===Q?_:e;if(!n[D][r]){t.bind(r+".jCanvas",function(e){i.x=e[$t];i.y=e.offsetY;i.type=r;i[K]=e;t[B]({resetFire:s});e.preventDefault()});n[D][r]=s}}}function tr(e){var t;for(t=0;t<e[f];t+=1)er(e[t])}function nr(e,t,n){var r,i,o,a,f,l,c,h;r=n._args;if(r[m]){i=Fn(e);o=i[K];if(o.x!==u&&o.y!==u){l=o.x*i[Pt];c=o.y*i[Pt];a=t.isPointInPath(l,c)||t[Vt]&&t[Vt](l,c)}f=i[d];r.eventX=r.mouseX=o.x;r.eventY=r.mouseY=o.y;r[K]=o[K];h=i[d][ut];l=r.eventX;c=r.eventY;if(h!==0){r[tt]=l*dn(-h)-c*pn(-h);r[nt]=c*dn(-h)+l*pn(-h)}else{r[tt]=l;r[nt]=c}r[tt]/=f[at];r[nt]/=f[ot];!a&&r[Dt]&&!r[gt]&&(r[jt]=s);a&&i[$].push(r);r[X]=a}}function rr(e,t){if(t.font)e.font=t.font;else{isNaN(Number(t[E]))||(t[E]+="px");e.font=t[Kt]+" "+t[E]+" "+t[qt]}}function ir(t,n,r,s){var o,u,a=/\b(\d*\.?\d*)\w\w\b/gi,c,p;if(bn.text===r.text&&bn.font===r.font&&bn[Kt]===r[Kt]&&bn[E]===r[E]&&bn[qt]===r[qt]&&bn[_t]===r[_t]&&bn[Z]===r[Z]){r[h]=bn[h];r[l]=bn[l]}else{r[h]=n[q](s[0])[h];for(c=1;c<s[f];c+=1){p=n[q](s[c])[h];p>r[h]&&(r[h]=p)}o=t[pt][E];if(r.font){u=r.font[Rt](a);u&&(t[pt][E]=r.font[Rt](a)[0])}else t[pt][E]=r[E];r[l]=i(e.css(t,E))*s[f]*r[Z];t[pt][E]=o}}function sr(e,t){var n=t.text,r=t[_t],i=n.split(" "),s,o=[],u="";if(e[q](n)[h]<r||i[f]===1)o=[n];else{for(s=0;s<i[f];s+=1){if(e[q](u+i[s])[h]>r){u!==""&&o.push(u);u=""}u+=i[s];s!==i[f]-1&&(u+=" ")}o.push(u)}o=o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n");return o}var f="length",l="height",c="layer",h="width",p="transparent",d="transforms",v="shadowColor",m="_event",g="splice",y="call",b="fillStyle",w="beginPath",E="fontSize",S="getLayers",x="translate",T="getLayerGroup",N="strokeStyle",C="visible",k="dragGroupWithLayer",L="getLayer",A="getContext",O="savedTransforms",M="sHeight",_="mousemove",D="events",P="_method",H="index",B="drawLayers",j="translateX",F="translateY",I="group",q="measureText",R="mouseover",U="closePath",z="sWidth",W="mousedown",X="intersects",V="drawImage",$="intersecting",J="_toRad",K="event",Q="mouseout",G="animating",Y="mouseup",Z="lineHeight",et="name",tt="_eventX",nt="_eventY",rt="jCanvas",it="touchstart",st="restore",ot="scaleY",ut="rotate",at="scaleX",ft="groups",lt="lineTo",ct="touchmove",ht="strokeWidth",pt="style",dt="bezierCurveTo",vt="autosave",mt="touchend",gt="_fired",yt="dragstart",bt="closed",wt="cursor",Et="concavity",St="shadowBlur",xt="slice",Tt="inDegrees",Nt="_startY",Ct="draggable",kt="_startX",Lt="animated",At="radius",Ot="dragstop",Mt="dragging",_t="maxWidth",Dt="_hovered",Pt="pixelRatio",Ht="hasOwnProperty",Bt="start",jt="_mousedout",Ft="_animating",It="drawArc",qt="fontFamily",Rt="match",Ut="imageSmoothing",zt="color",Wt="<canvas />",Xt="drawQuadratic",Vt="isPointInStroke",$t="offsetX",Jt="moveTo",Kt="fontStyle",Qt="drawPolygon",Gt="drawEllipse",Yt="load",Zt="complete",en="restoreCanvas",tn="drawVector",nn="setLayer",rn="createPattern",sn="drawBezier",on,un=e.extend,an=e.inArray,fn=e.type,ln=e.isFunction,cn=r.round,hn=r.PI,pn=r.sin,dn=r.cos,vn=e[K].fix,mn,gn,yn,bn={},wn={rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:[]},En,Sn;e.fn[rt]=Tn;Tn[D]={};on={align:"center",autosave:s,baseline:"middle",bringToFront:o,ccw:o,closed:o,compositing:"source-over",concavity:0,cornerRadius:0,count:1,cropFromCenter:s,disableDrag:o,disableEvents:o,domain:u,draggable:o,group:u,data:{},each:u,end:360,fillStyle:p,font:"",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:s,fn:u,graph:"y",height:u,imageSmoothing:s,inDegrees:s,lineHeight:1,layer:o,load:u,mask:o,maxWidth:u,miterLimit:10,name:u,opacity:1,projection:0,r1:u,r2:u,radius:0,range:u,repeat:"repeat",respectAlign:o,rotate:0,rounded:o,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:p,shadowStroke:!1,shadowX:0,shadowY:0,sHeight:u,sides:0,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:p,strokeWidth:1,sWidth:u,sx:u,sy:u,text:"",translate:0,translateX:0,translateY:0,type:u,visible:s,width:u,x:0,y:0};Tn();Tn.extend=function(n){Tn.defaults=un(on,n.props);Tn();n[et]&&(e.fn[n[et]]=function r(e){var t=this,i,s,o,u=new xn(e);for(s=0;s<t[f];s+=1){i=t[s];o=Cn(i);if(o){e=Xn(i,u,e,r);On(i,o,u);n.fn[y](i,o,u)}}return t});return e.fn[n[et]]};e.fn[S]=function(t){var n=this[0],r,i,s=[];if(n&&n[A]){r=Fn(n).layers;if(ln(t))for(i=0;i<r[f];i+=1)t[y](n,r[i])&&s.push(r[i]);else s=r}return s};e.fn[L]=function(t){var n=this[S](),r=fn(t),i=Fn(this[0]),s,o;if(t&&t[c])s=t;else if(r==="number"){t<0&&(t=n[f]+t);s=n[t]}else if(r==="regexp"){for(o=0;o<n[f];o+=1)if(Nn(n[o][et])&&n[o][et][Rt](t)){s=n[o];break}}else{i=Fn(this[0]);s=i[c].names[t]}return s};e.fn[T]=function(t){var n=fn(t),r,i,s,o;if(n==="array")return t;if(n==="regexp"){o=Fn(this[0]);r=o[ft];for(i in r)if(i[Rt](t)){s=r[i];break}}else{o=Fn(this[0]);s=o[c][ft][t]}return s};e.fn.getLayerIndex=function(t){var n=this[S](),r=this[L](t);return an(r,n)};e.fn[nn]=function(n,r){var i=this,s,o,u,a;for(o=0;o<i[f];o+=1){s=e(i[o]);u=Fn(i[o]);a=e(i[o])[L](n);if(a){Un(s,u,a,r);zn(s,u,a,r);un(a,r);In(s,u,a);Rn(s,u,a)}}return i};e.fn.setLayerGroup=function(n,r){var i=this,s,o,u,a;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[T](n);if(u)for(a=0;a<u[f];a+=1)s[nn](u[a],r)}return i};e.fn.setLayers=function(n){var r=this,i,s,o,u;for(s=0;s<r[f];s+=1){i=e(r[s]);o=e(r[s])[S]();for(u=0;u<o[f];u+=1)i[nn](o[u],n)}return r};e.fn.moveLayer=function(n,r){var i=this,s,o,u,a;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[S]();a=s[L](n);if(a){a[H]=an(a,u);u[g](a[H],1);u[g](r,0,a);r<0&&(r=u[f]+r);a[H]=r}}return i};e.fn.removeLayer=function(n){var r=this,i,s,o,a,l;for(s=0;s<r[f];s+=1){i=e(r[s]);o=Fn(r[s]);a=i[S]();l=i[L](n);if(l){l[H]=an(l,a);a[g](l[H],1);Un(i,o,l,{name:u});zn(i,o,l,{group:u})}}return r};e.fn.removeLayerGroup=function(n){var r=this,i,s,o,l,h,p,d;if(n!==a)for(s=0;s<r[f];s+=1){i=e(r[s]);o=Fn(r[s]);l=i[S]();h=i[T](n);if(h){for(d=0;d<h[f];d+=1){p=h[d];p[H]=an(p,l);l[g](p[H],1);Un(i,o,p,{name:u})}delete o[c][ft][h[et]]}}return r};e.fn.removeLayers=function(){var n=this,r,i,s;for(i=0;i<n[f];i+=1){r=e(n[i]);s=Fn(n[i]);s.layers[f]=0;s[c].names={};s[c][ft]={}}return n};e.fn.drawLayer=function(n){var r=this,i,s,o,u;for(i=0;i<r[f];i+=1){o=e(r[i]);s=Cn(r[i]);u=o[L](n);Wn(o,s,u)}return r};e.fn[B]=function(n){var r=this,i,a,l,h=un({},n),p,v,b,w,E,S,x,T,N,L,A,M;h[H]||(h[H]=0);for(a=0;a<r[f];a+=1){i=e(r[a]);l=Cn(r[a]);if(l){x=Fn(r[a]);h.clear!==o&&i.clearCanvas();p=x.layers;for(b=h[H];b<p[f];b+=1){v=p[b];v[H]=b;h.resetFire&&(v[gt]=o);v[m]=!v.disableEvents;Wn(i,l,v,b+1);v._masks=x[d].masks[xt](0);if(v[jt]){v[jt]=o;v[gt]=s;v[Dt]=o;v[Q]&&v[Q][y](r[a],v);v[wt]&&v._cursor&&i.css({cursor:v._cursor})}if(v[P]===e.fn[V]&&v[C])break}w=b;v={};for(E=x[$][f]-1;E>=0;E-=1){v=x[$][E];for(S=v._masks[f]-1;S>=0;S-=1)if(!v._masks[S][X]){v[X]=o;break}if(v[X])break}T=x[K];N=T.type;v[N]||(N=Zn(N));M=v[N];L=x.drag;if(v[m]&&v[X]){if(v[R]||v[Q]||v[wt])if(!v[Dt]&&!v[gt]){v[gt]=s;v[Dt]=s;v[R]&&v[R][y](r[a],v);if(v[wt]){v._cursor=i.css(wt);i.css({cursor:v[wt]})}}if(M&&!v[gt]){v[gt]=s;T.type=u;M[y](r[a],v)}v[Ct]&&!v.disableDrag&&(N===W||N===it)&&(L[c]=v)}if(L[c])if(N===_||N===ct){if(!L[Mt]){L[Mt]=s;if(L[c].bringToFront){p[g](L[c][H],1);L[c][H]=p.push(L[c])}A=x[c][ft][L[c][I]];if(L[c][I]&&L[c][k]&&A)for(b=0;b<A[f];b+=1)if(A[b]!==L[c]){A[b][kt]=A[b].x;A[b][Nt]=A[b].y;A[b]._endX=L[c][tt];A[b]._endY=L[c][nt];if(A[b].bringToFront){A[b][H]=an(A[b],p);p[g](A[b][H],1);p[g](-1,0,A[b]);A[b][H]=p[f]-2}A[b][yt]&&A[b][yt][y](r[a],A[b])}L[kt]=L[c][kt]=L[c].x;L[Nt]=L[c][Nt]=L[c].y;L._endX=L[c]._endX=L[c][tt];L._endY=L[c]._endY=L[c][nt];L[c][yt]&&L[c][yt][y](i[0],L[c])}L[c].x=L[c][tt]-(L._endX-L[kt]);L[c].y=L[c][nt]-(L._endY-L[Nt]);A=x[c][ft][L[c][I]];if(L[c][I]&&L[c][k]&&A)for(b=0;b<A[f];b+=1)if(A[b]!==L[c]){A[b].x=L[c][tt]-(A[b]._endX-A[b][kt]);A[b].y=L[c][nt]-(A[b]._endY-A[b][Nt]);A[b].drag&&A[b].drag[y](r[a],A[b])}L[c].drag&&L[c].drag[y](r[a],L[c])}else if(N===Y||N===mt){if(L[c][Ot]&&L[Mt]){L[c][Ot][y](r[a],L[c]);L[Mt]=o}A=x[c][ft][L[c][I]];if(L[c][I]&&L[c][k]&&A)for(b=0;b<A[f];b+=1)A[b]!==L[c]&&A[b][Ot]&&A[b][Ot][y](r[a],A[b]);x.drag={}}if(w===p[f]){x[$][f]=0;x[d]=kn(wn);x[O][f]=0}}}return r};e.fn.addLayer=function(t){var n=this,r,i,o=un({},t);for(r=0;r<n[f];r+=1){i=Cn(n[r]);if(i){o[c]=s;t=Xn(n[r],o,t)}}return n};En=[h,l,"opacity",Z];Sn={};e.fn.animateLayer=function(){function v(e,t,n){return function(){Vn(n);(!t[G]||t[Lt]===n)&&e[B]();c[4]&&c[4][y](e[0],n);n[Ft]=o;t[G]=o;t[Lt]=u}}function m(e,t,n){return function(r,i){Vn(n);if(!n[Ft]&&!t[G]){n[Ft]=s;t[G]=s;t[Lt]=n}(!t[G]||t[Lt]===n)&&e[B]();c[5]&&c[5][y](e[0],r,i,n)}}var n=this,r,i,l,c=[][xt][y](arguments,0),h,p,d;if(fn(c[2])==="object"){c[g](2,0,c[2].duration||u);c[g](3,0,c[3].easing||u);c[g](4,0,c[4][Zt]||u);c[g](5,0,c[5].step||u)}else{if(c[2]===a){c[g](2,0,u);c[g](3,0,u);c[g](4,0,u)}else if(ln(c[2])){c[g](2,0,u);c[g](3,0,u)}if(c[3]===a){c[3]=u;c[g](4,0,u)}else ln(c[3])&&c[g](3,0,u)}for(i=0;i<n[f];i+=1){r=e(n[i]);l=Cn(n[i]);if(l){h=Fn(n[i]);p=r[L](c[0]);if(p&&p[P]!==e.fn.draw){d=un({},c[1]);d=Jn(n[i],p,d);$n(d,s);$n(p);p[pt]=Sn;e(p).animate(d,{duration:c[2],easing:e.easing[c[3]]?c[3]:u,complete:v(r,h,p),step:m(r,h,p)})}}}return n};e.fn.animateLayerGroup=function(n){var r=this,i,s,o=[][xt][y](arguments,0),u,a;for(s=0;s<r[f];s+=1){i=e(r[s]);u=i[T](n);for(a=0;a<u[f];a+=1)i.animateLayer.apply(i,[u[a]].concat(o[xt](1)))}return r};e.fn.delayLayer=function(n,r){var i=this,s,o;r=r||0;for(s=0;s<i[f];s+=1){o=e(i[s])[L](n);e(o).delay(r)}return i};e.fn.delayLayerGroup=function(n,r){var i=this,s,o,u,a,l;r=r||0;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[T](n);if(u)for(l=0;l<u[f];l+=1){a=u[l];a&&e(a).delay(r)}}return i};e.fn.stopLayer=function(n,r){var i=this,s,o,u;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[L](n);u&&e(u).stop(r)}return i};e.fn.stopLayerGroup=function(n,r){var i=this,s,o,u,a,l;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[T](n);if(u)for(l=0;l<u[f];l+=1){a=u[l];a&&e(a).stop(r)}}return i};Gn([zt,"backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor",b,"outlineColor",N,v]);mn={mousedown:it,mouseup:mt,mousemove:ct};gn={touchstart:W,touchend:Y,touchmove:_};tr(["click","dblclick",W,Y,_,R,Q,it,ct,mt]);e[K].fix=function(t){var n,r,i;t=vn[y](e[K],t);r=t.originalEvent;if(r){i=r.changedTouches;if(t.pageX!==a&&t[$t]===a){n=e(t.target).offset();if(n){t[$t]=t.pageX-n.left;t.offsetY=t.pageY-n.top}}else if(i){n=e(r.target).offset();if(n){t[$t]=i[0].pageX-n.left;t.offsetY=i[0].pageY-n.top}}}return t};yn={arc:It,bezier:sn,circle:It,ellipse:Gt,"function":"draw",image:V,line:"drawLine",polygon:Qt,quadratic:Xt,rectangle:"drawRect",text:"drawText",vector:tn};e.fn.draw=function or(t){var n=this,r,i,s,o;o=new xn(t);for(i=0;i<n[f];i+=1){r=e(n[i]);s=Cn(n[i]);if(s){t=Xn(n[i],o,t,or);o[C]&&(o.fn?o.fn[y](n[i],s,o):o[P]!==or&&o[P][y](r,t))}}return n};e.fn.clearCanvas=function(t){var n=this,r,i,s=new xn(t);for(r=0;r<n[f];r+=1){i=Cn(n[r]);if(i)if(s[h]===u||s[l]===u){i.save();i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,n[r][h],n[r][l]);i[st]()}else{jn(i,s,s[h],s[l]);i.clearRect(s.x-s[h]/2,s.y-s[l]/2,s[h],s[l]);i[st]()}}return n};e.fn.saveCanvas=function ur(e){var t=this,n,r,i=new xn(e),s,o;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){s=Fn(t[n]);e=Xn(t[n],i,e,ur);for(o=0;o<i.count;o+=1)Ln(r,s)}}return t};e.fn[en]=function ar(e){var t=this,n,r,i=new xn(e),s,o;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){s=Fn(t[n]);e=Xn(t[n],i,e,ar);for(o=0;o<i.count;o+=1)An(r,s)}}return t};e.fn.restoreCanvasOnRedraw=function(t){var n=this,r=un({},t);r[c]=s;n[en](r);return n};e.fn.rotateCanvas=function fr(e){var t=this,n,r,i=new xn(e),s;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){s=Fn(t[n]);e=Xn(t[n],i,e,fr);i[vt]&&Ln(r,s);Pn(r,i,s[d])}}return t};e.fn.scaleCanvas=function lr(e){var t=this,n,r,i=new xn(e),s;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){s=Fn(t[n]);e=Xn(t[n],i,e,lr);i[vt]&&Ln(r,s);Hn(r,i,s[d])}}return t};e.fn.translateCanvas=function cr(e){var t=this,n,r,i=new xn(e),s;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){s=Fn(t[n]);e=Xn(t[n],i,e,cr);i[vt]&&Ln(r,s);Bn(r,i,s[d])}}return t};e.fn.drawRect=function hr(e){var t=this,n,r,i=new xn(e),u,a,c,p,d;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=Xn(t[n],i,e,hr);if(i[C]){On(t[n],r,i);jn(r,i,i[h],i[l]);r[w]();u=i.x-i[h]/2;a=i.y-i[l]/2;d=i.cornerRadius;if(d){i[bt]=s;c=i.x+i[h]/2;p=i.y+i[l]/2;c-u-2*d<0&&(d=(c-u)/2);p-a-2*d<0&&(d=(p-a)/2);r[Jt](u+d,a);r[lt](c-d,a);r.arc(c-d,a+d,d,3*hn/2,hn*2,o);r[lt](c,p-d);r.arc(c-d,p-d,d,0,hn/2,o);r[lt](u+d,p);r.arc(u+d,p-d,d,hn/2,hn,o);r[lt](u,a+d);r.arc(u+d,a+d,d,hn,3*hn/2,o)}else r.rect(u,a,i[h],i[l]);i[m]&&nr(t[n],r,i);Dn(t[n],r,i)}}}return t};e.fn[It]=function pr(e){var t=this,n,r,i=new xn(e);e=e||{};i[c]&&!i[Tt]&&i.end===360&&(e.end=i.end=hn*2);for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=Xn(t[n],i,e,pr);if(i[C]){On(t[n],r,i);jn(r,i,i[At]*2);r[w]();r.arc(i.x,i.y,i[At],i[Bt]*i[J]-hn/2,i.end*i[J]-hn/2,i.ccw);i[m]&&nr(t[n],r,i);Dn(t[n],r,i)}}}return t};e.fn[Gt]=function dr(e){var t=this,n,r,i=new xn(e),o=i[h]*(4/3),u=i[l];i[bt]=s;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=Xn(t[n],i,e,dr);if(i[C]){On(t[n],r,i);jn(r,i,i[h],i[l]);r[w]();r[Jt](i.x,i.y-u/2);r[dt](i.x-o/2,i.y-u/2,i.x-o/2,i.y+u/2,i.x,i.y+u/2);r[dt](i.x+o/2,i.y+u/2,i.x+o/2,i.y-u/2,i.x,i.y-u/2);i[m]&&nr(t[n],r,i);Dn(t[n],r,i)}}}return t};e.fn[Qt]=function vr(e){var t=this,n,r,i=new xn(e),o=2*hn/i.sides,u=o/2,a=u+hn/2,l=i[At]*dn(u),c,h,p;i.projection&&(i[Et]=-i.projection);for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=Xn(t[n],i,e,vr);if(i[C]){On(t[n],r,i);jn(r,i,i[At]*2);r[w]();for(p=0;p<i.sides;p+=1){c=i.x+i[At]*dn(a);h=i.y+i[At]*pn(a);r[lt](c,h);if(i[Et]){c=i.x+(l+ -l*i[Et])*dn(a+u);h=i.y+(l+ -l*i[Et])*pn(a+u);r[lt](c,h)}a+=o}i[m]&&nr(t[n],r,i);i[bt]=s;Dn(t[n],r,i)}}}return t};e.fn.drawLine=function mr(e){var t=this,n,r,i=new xn(e),o,u,l;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=Xn(t[n],i,e,mr);if(i[C]){On(t[n],r,i);jn(r,i,0);o=1;r[w]();while(s){u=i["x"+o];l=i["y"+o];if(u===a||l===a)break;r[lt](u+i.x,l+i.y);o+=1}i[m]&&nr(t[n],r,i);Dn(t[n],r,i)}}}return t};e.fn[Xt]=e.fn.drawQuad=function gr(e){var t=this,n,r,i=new xn(e),o,u,l,c,h;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=Xn(t[n],i,e,gr);if(i[C]){On(t[n],r,i);jn(r,i,0);o=2;r[w]();r[Jt](i.x1+i.x,i.y1+i.y);while(s){u=i["x"+o];l=i["y"+o];c=i["cx"+(o-1)];h=i["cy"+(o-1)];if(u===a||l===a||c===a||h===a)break;r.quadraticCurveTo(c+i.x,h+i.y,u+i.x,l+i.y);o+=1}i[m]&&nr(t[n],r,i);Dn(t[n],r,i)}}}return t};e.fn[sn]=function yr(e){var t=this,n,r,i=new xn(e),o,u,l,c,h,p,d,v;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=Xn(t[n],i,e,yr);if(i[C]){On(t[n],r,i);jn(r,i,0);o=2;u=1;r[w]();r[Jt](i.x1+i.x,i.y1+i.y);while(s){l=i["x"+o];c=i["y"+o];h=i["cx"+u];p=i["cy"+u];d=i["cx"+(u+1)];v=i["cy"+(u+1)];if(l===a||c===a||h===a||p===a||d===a||v===a)break;r[dt](h+i.x,p+i.y,d+i.x,v+i.y,l+i.x,c+i.y);o+=1;u+=2}i[m]&&nr(t[n],r,i);Dn(t[n],r,i)}}}return t};e.fn[tn]=function br(e){var t=this,n,i,o=new xn(e),u,l,c,h,p;for(n=0;n<t[f];n+=1){i=Cn(t[n]);if(i){e=Xn(t[n],o,e,br);if(o[C]){On(t[n],i,o);jn(i,o,0);u=1;i[w]();h=o.x;p=o.y;i[Jt](o.x,o.y);while(s){l=o["a"+u];c=o["l"+u];if(l===a||c===a)break;l=l*o[J]-hn/2;h+=c*r.cos(l);p+=c*r.sin(l);i[lt](h,p);u+=1}o[m]&&nr(t[n],i,o);Dn(t[n],i,o)}}}return t};e.fn.drawText=function wr(t){var n=this,r,i,s,o=new xn(t),a,d,g,y;for(i=0;i<n[f];i+=1){r=e(n[i]);s=Cn(n[i]);if(s){t=Xn(n[i],o,t,wr);if(o[C]){On(n[i],s,o);s.textBaseline=o.baseline;s.textAlign=o.align;rr(s,o);!i&&o[_t]!==u?a=sr(s,o):i||(a=String(o.text).split("\n"));if(!i){ir(n[i],s,o,a);if(t&&o[c]){t[h]=o[h];t[l]=o[l]}g=o.x;o.align==="left"?o.respectAlign?o.x+=o[h]/2:g-=o[h]/2:o.align==="right"&&(o.respectAlign?o.x-=o[h]/2:g+=o[h]/2)}jn(s,o,o[h],o[l]);for(d=0;d<a[f];d+=1){s[v]=o[v];y=o.y+d*o[l]/a[f]-(a[f]-1)*o[l]/a[f]/2;s.fillText(a[d],g,y);o[b]!==p&&(s[v]=p);s.strokeText(a[d],g,y)}if(o[m]){s[w]();s.rect(o.x-o[h]/2,o.y-o[l]/2,o[h],o[l]);nr(n[i],s,o);s[U]()}_n(s,o)}}}bn=o;return n};e.fn[q]=function Er(e){var t=this,n,r,i;e===a||fn(e)==="object"&&!e[c]?r=new xn(e):r=t[L](e);n=Cn(t[0]);if(n){rr(n,r);i=sr(n,r);Er(t[0],n,r,i)}return r};e.fn[V]=function Sr(t){function S(e,n){if(e===0){v[h]===u&&v[z]===u&&(v[h]=v[z]=g[h]);v[l]===u&&v[M]===u&&(v[l]=v[M]=g[l]);if(t&&v[c]){t[h]=v[h];t[l]=v[l]}}if(v[z]!==u&&v[M]!==u&&v.sx!==u&&v.sy!==u){if(e===0){v[h]===u&&(v[h]=v[z]);v[l]===u&&(v[l]=v[M]);if(!v.cropFromCenter){v.sx+=v[z]/2;v.sy+=v[M]/2}v.sx+v[z]/2>g[h]&&(v.sx=g[h]-v[z]/2);v.sx-v[z]/2<0&&(v.sx=v[z]/2);v.sy-v[M]/2<0&&(v.sy=v[M]/2);v.sy+v[M]/2>g[l]&&(v.sy=g[l]-v[M]/2)}jn(n,v,v[h],v[l]);n[V](g,v.sx-v[z]/2,v.sy-v[M]/2,v[z],v[M],v.x-v[h]/2,v.y-v[l]/2,v[h],v[l])}else{jn(n,v,v[h],v[l]);n[V](g,v.x-v[h]/2,v.y-v[l]/2,v[h],v[l])}On(r[e],n,v);n[w]();n.rect(v.x-v[h]/2,v.y-v[l]/2,v[h],v[l]);v[m]&&nr(r[e],n,v);d=Fn(r[e]);n[U]();n.stroke();_n(n,v);Mn(n,d,v)}function x(n,r,i){return function(){S(r,i);v[Yt]&&v[Yt][y](n,t);v[c]&&v._next&&e(n)[B]({clear:o,resetFire:s,index:v._next})}}var r=this,i,a,p,d,v=new xn(t),g,b,E;E=v.source;b=E[A];if(E.src||b)g=E;else if(E)if(bn.source===E)g=bn._source;else{g=new n;g.src=E;bn.source=E;bn._source=g}for(a=0;a<r[f];a+=1){i=r[a];p=Cn(r[a]);if(p){t=Xn(r[a],v,t,Sr);if(v[C]&&g)if(g[Zt]||b)x(i,a,p)();else{e(g).bind(Yt,x(i,a,p));g.src=g.src}}}return r};e.fn[rn]=e.fn.pattern=function(r){function d(){f=s[rn](a,o.repeat);o[Yt]&&o[Yt][y](i[0],f)}var i=this,s,o=new xn(r),a,f,c,p;s=Cn(i[0]);if(s){p=o.source;if(ln(p)){a=e(Wt)[0];a[h]=o[h];a[l]=o[l];c=Cn(a);p[y](a,c);d()}else{c=p[A];if(p.src||c)a=p;else{a=new n;a.src=p}if(a[Zt]||c)d();else{e(a).bind(Yt,d);a.src=a.src}}}else f=u;return f};e.fn.createGradient=e.fn.gradient=function(t){var n=this,r,i=new xn(t),s,o=[],l,c,h,p,d,v,m;r=Cn(n[0]);if(r){i.x1=i.x1||0;i.y1=i.y1||0;i.x2=i.x2||0;i.y2=i.y2||0;i.r1!==u||i.r2!==u?s=r.createRadialGradient(i.x1,i.y1,i.r1,i.x2,i.y2,i.r2):s=r.createLinearGradient(i.x1,i.y1,i.x2,i.y2);for(p=1;i["c"+p]!==a;p+=1)i["s"+p]!==a?o.push(i["s"+p]):o.push(u);l=o[f];o[0]===u&&(o[0]=0);o[l-1]===u&&(o[l-1]=1);for(p=0;p<l;p+=1){if(o[p]!==u){v=1;m=0;c=o[p];for(d=p+1;d<l;d+=1){if(o[d]!==u){h=o[d];break}v+=1}c>h&&(o[d]=o[p])}else if(o[p]===u){m+=1;o[p]=c+m*((h-c)/v)}s.addColorStop(o[p],i["c"+(p+1)])}}else s=u;return s};e.fn.setPixels=function xr(e){var t=this,n,r,i,s=new xn(e),o={},a,c,p,d;for(r=0;r<t[f];r+=1){n=t[r];i=Cn(n);if(i){e=Xn(n,s,e,xr);jn(i,s,s[h],s[l]);if(s[h]===u||s[l]===u){s[h]=n[h];s[l]=n[l];s.x=s[h]/2;s.y=s[l]/2}if(s[h]!==0&&s[l]!==0){a=i.getImageData(s.x-s[h]/2,s.y-s[l]/2,s[h],s[l]);c=a.data;d=c[f];o=[];if(s.each)for(p=0;p<d;p+=4){o.r=c[p];o.g=c[p+1];o.b=c[p+2];o.a=c[p+3];s.each[y](n,o);c[p]=o.r;c[p+1]=o.g;c[p+2]=o.b;c[p+3]=o.a}i.putImageData(a,s.x-s[h]/2,s.y-s[l]/2);i[st]()}}}return t};e.fn.getCanvasImage=function(t,n){var r=this[0];n===a&&(n=1);return r&&r.toDataURL?r.toDataURL("image/"+t,n):u};e.fn.detectPixelRatio=function(n){var r=this,i,o,u,a,c,p,d,v,m,g;for(u=0;u<r[f];u+=1){o=r[u];i=e(r[u]);a=Cn(o);g=Fn(r[u]);if(!g.scaled){c=window.devicePixelRatio||1;p=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;d=c/p;if(d!==1){v=o[h];m=o[l];o[h]=v*d;o[l]=m*d;o[pt][h]=v+"px";o[pt][l]=m+"px";a.scale(d,d)}g[Pt]=d;g.scaled=s;n&&n[y](o,d)}}return r};e.support.canvas=e(Wt)[0][A]!==a;Tn.defaults=on;Tn.detectEvents=nr;Tn[U]=Dn;e[rt]=Tn})(jQuery,document,Image,Math,parseFloat,!0,!1,null);